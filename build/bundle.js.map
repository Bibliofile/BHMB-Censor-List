{"version":3,"file":"bundle.js","sources":["../src/index.ts"],"sourcesContent":["import { MessageBot, Player } from '@bhmb/bot'\nimport { UIExtensionExports } from '@bhmb/ui'\n\nimport html from './tab.html'\n\nfunction normalizeMessage(message: string) {\n  function filter(c: string) {\n    let check = (characters: string[]) => characters.some(test => test == c)\n\n    if (check(['æ', 'ä', 'å', 'á', 'à', 'ã', 'â', 'ā'])) {\n      return 'a'\n    } else if (check(['ß'])) {\n      return 'b'\n    } else if (check(['ç', 'č', 'ć', String.fromCharCode(1089)])) {\n      return 'c'\n    } else if (check(['é', 'ê', 'è', 'ë', 'ę', 'ė', 'ē'])) {\n      return 'e'\n    } else if (check(['î', 'ï', 'í', 'ī', 'į', 'Ì'])) {\n      return 'i'\n    } else if (check(['ł'])) {\n      return 'l'\n    } else if (check(['ñ', 'ń'])) {\n      return 'n'\n    } else if (check(['œ', 'ö', 'ó', 'õ', 'ô', 'ø', 'ò', 'ō'])) {\n      return 'o'\n    } else if (check(['ś', 'š'])) {\n      return 's'\n    } else if (check(['ü', 'ù', 'ú', 'û', 'ū'])) {\n      return 'u'\n    } else if (check(['ÿ'])) {\n      return 'y'\n    } else if (check(['ż', 'ź', 'ž'])) {\n      return 'z'\n    }\n\n    return c\n  }\n\n  message = message.toLocaleLowerCase()\n  var filtered = ''\n  for (var i = 0; i < message.length; i++) {\n    filtered += filter(message[i])\n  }\n  return filtered.replace(/[ \\t]/g, '')\n}\n\n\nMessageBot.registerExtension('bibliofile/censoring', (ex, world) => {\n  const getMessage = () => ex.storage.get('message', '/kick {{NAME}}')\n  const getList = () => ex.storage.get<string[]>('list', [])\n\n  function listener({player, message}: {player: Player, message: string}) {\n    if (player.isStaff) return\n\n    let normal = normalizeMessage(message)\n    if (getList().some(word => normal.includes(normalizeMessage(word)))) {\n      ex.bot.send(getMessage(), { name: player.name })\n    }\n  }\n\n  world.onMessage.sub(listener)\n\n  ex.remove = () => world.onMessage.unsub(listener)\n\n\n  // Browser only\n  let ui = ex.bot.getExports('ui') as UIExtensionExports | undefined\n  if (!ui) return\n\n  let tab = ui.addTab('Censoring')\n  tab.innerHTML = html\n\n  let input = tab.querySelector('input') as HTMLInputElement\n  let textarea = tab.querySelector('textarea') as HTMLTextAreaElement\n\n  input.value = getMessage()\n  textarea.value = getList().join('\\n')\n\n  textarea.addEventListener('keyup', () => {\n    textarea.style.height = 'auto'\n    textarea.style.height = textarea.scrollHeight + 'px'\n  })\n\n  tab.addEventListener('input', function () {\n    ex.storage.set('message', input.value)\n    ex.storage.set('list', textarea.value.split(/\\r?\\n/).filter(v => v.length > 1))\n  })\n\n  ex.remove = () => {\n    world.onMessage.unsub(listener)\n    // Not sure why this isn't typed correctly. This is safe.\n    ;(ui as UIExtensionExports).removeTab(tab)\n  }\n})\n"],"names":["MessageBot"],"mappings":"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"}