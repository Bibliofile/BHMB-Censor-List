{"version":3,"file":"bundle.js","sources":["../src/index.ts"],"sourcesContent":["import { MessageBot, Player } from '@bhmb/bot'\r\nimport { UIExtensionExports } from '@bhmb/ui'\r\n\r\nimport html from './tab.html'\r\n\r\nfunction normalizeMessage(message: string) {\r\n  function filter(c: string) {\r\n    let check = (characters: string[]) => characters.some(test => test == c)\r\n\r\n    if (check(['æ', 'ä', 'å', 'á', 'à', 'ã', 'â', 'ā'])) {\r\n      return 'a'\r\n    } else if (check(['ß'])) {\r\n      return 'b'\r\n    } else if (check(['ç', 'č', 'ć'])) {\r\n      return 'c'\r\n    } else if (check(['é', 'ê', 'è', 'ë', 'ę', 'ė', 'ē'])) {\r\n      return 'e'\r\n    } else if (check(['î', 'ï', 'í', 'ī', 'į', 'Ì'])) {\r\n      return 'i'\r\n    } else if (check(['ł'])) {\r\n      return 'l'\r\n    } else if (check(['ñ', 'ń'])) {\r\n      return 'n'\r\n    } else if (check(['œ', 'ö', 'ó', 'õ', 'ô', 'ø', 'ò', 'ō'])) {\r\n      return 'o'\r\n    } else if (check(['ś', 'š'])) {\r\n      return 's'\r\n    } else if (check(['ü', 'ù', 'ú', 'û', 'ū'])) {\r\n      return 'u'\r\n    } else if (check(['ÿ'])) {\r\n      return 'y'\r\n    } else if (check(['ż', 'ź', 'ž'])) {\r\n      return 'z'\r\n    }\r\n\r\n    return c\r\n  }\r\n\r\n  message = message.toLocaleLowerCase()\r\n  var filtered = ''\r\n  for (var i = 0; i < message.length; i++) {\r\n    filtered += filter(message[i])\r\n  }\r\n  return filtered.replace(/[ \\t]/g, '')\r\n}\r\n\r\n\r\nMessageBot.registerExtension('bibliofile/censoring', (ex, world) => {\r\n  const getMessage = () => ex.storage.get('message', '/kick {{NAME}}')\r\n  const getList = () => ex.storage.get<string[]>('list', [])\r\n\r\n  function listener({player, message}: {player: Player, message: string}) {\r\n    if (player.isStaff) return\r\n\r\n    let normal = normalizeMessage(message)\r\n    if (getList().some(word => normal.includes(normalizeMessage(word)))) {\r\n      ex.bot.send(getMessage(), { name: player.name })\r\n    }\r\n  }\r\n\r\n  world.onMessage.sub(listener)\r\n\r\n  ex.remove = () => world.onMessage.unsub(listener)\r\n\r\n\r\n  // Browser only\r\n  let ui = ex.bot.getExports('ui') as UIExtensionExports | undefined\r\n  if (!ui) return\r\n\r\n  let tab = ui.addTab('Censoring')\r\n  tab.innerHTML = html\r\n\r\n  let input = tab.querySelector('input') as HTMLInputElement\r\n  let textarea = tab.querySelector('textarea') as HTMLTextAreaElement\r\n\r\n  input.value = getMessage()\r\n  textarea.value = getList().join('\\n')\r\n\r\n  textarea.addEventListener('keyup', () => {\r\n    textarea.style.height = 'auto'\r\n    textarea.style.height = textarea.scrollHeight + 'px'\r\n  })\r\n\r\n  tab.addEventListener('input', function () {\r\n    ex.storage.set('message', input.value)\r\n    ex.storage.set('list', textarea.value.split(/\\r?\\n/).filter(v => v.length > 1))\r\n  })\r\n\r\n  ex.remove = () => {\r\n    world.onMessage.unsub(listener)\r\n    // Not sure why this isn't typed correctly. This is safe.\r\n    ;(ui as UIExtensionExports).removeTab(tab)\r\n  }\r\n})\r\n"],"names":["MessageBot"],"mappings":"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"}